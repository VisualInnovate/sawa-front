import{_ as w,L as C,a as k,bp as V,c as r,r as m,o as f,d as T,f as o,g as u,e as a,H as S,j as E,w as H,t as d,n as _,Y as M,F as A}from"./main-e9f01f56.js";import{h as p}from"./moment-fbc5633a.js";import{F as U,i as $,a as L,b as B,c as F,l as G}from"./index-670e9fa7.js";import"./flowbite-vue-8fc2b8bb.js";const I={components:{FullCalendar:U,Calendar:C,InputText:k},data(){return{filter:{},not_find:!1,childreen:[],modal_text:!1,evaluate_types:[{name:"side profile",id:1},{name:"milestone",id:2},{name:"barrier",id:3},{name:"ablls",id:4},{name:"carolina",id:5}],event_types:[{name:"تقيممات",id:1},{name:"اجتماعات",id:2}],users:[],business_hours:[],langStore:V(),visible:!1,updateevent:!1,event:{color:"87ceeb"},submitted:!1,employees:[],avalible_day:[],days:[0,1,2,3,4,5,6],doctorshow:"",create_visible:!1,event_id:null,opts:{plugins:[$,L,B,F],initialView:"dayGridMonth",locale:null,slotDuration:"00:30:00",slotLabelInterval:"00:30:00",hiddenDays:[],slotMinTime:"00:00:00",slotMaxTime:"00:00:00",selectable:!0,editable:!0,validRange:{start:new Date},headerToolbar:{left:"title",center:"prev next today",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},selectAllow:t=>{const l=this.$refs.fullCalendar.getApi().getEvents();for(let n of l)if(p(t.start).isSame(n.start,"day")&&(t.start>=n.start&&t.start<n.end||t.end>n.start&&t.end<=n.end))return!1;return!0},eventClick:this.handleEventClick.bind(this),dateClick:this.handleDateClick,datesSet:this.handleDatesSet.bind(this),select:this.handleSelect.bind(this)}}},methods:{goBack(){this.$router.go(-1)},fetchEmployees(){r.get("api/employees").then(t=>{this.employees=t.data.data}).catch(t=>console.error("Error retrieving doctors:",t))},handleDatesSet(t){if(this.business_hours.length>=1){const s=new Date(t.startStr);this.opts.slotMinTime=this.business_hours.find(l=>l.day===s.getDay()).start,this.opts.slotMaxTime=this.business_hours.find(l=>l.day===s.getDay()).end}},getClidreen(){r.get("/api/child").then(t=>{this.childreen=t.data.children})},updateEvents(){r.get(`/api/event-calendar?employee_id=${this.event.employee_id}&type=${this.event.type}`).then(t=>{this.opts.events=t.data.data.map(s=>({title:s.title,start:s.start,end:s.end,type:s.type,col:s.color,id:s.id,backgroundColor:"#"+s.color}))})},create(){r.post("api/evaluation-request",{employee_id:this.event.employee_id,color:this.event.color,title:this.event.title,evaluation_type:this.event.evaluation_type,consultant_id:localStorage.getItem("user_id"),child_id:this.event.child_id,date:p(this.opts.event.end).format(" YYYY-MM-DD"),start_time:p(this.opts.event.start).format("HH:mm:ss"),end_time:p(this.opts.event.end).format("HH:mm:ss")}).then(t=>{this.visible=!this.visible,this.$toast.add({severity:"success",summary:this.$t("success_message"),detail:`${this.$t("element_add_success")}`,life:3e3}),this.getTimes()}).catch(t=>{this.$toast.add({severity:"error",summary:this.$t("error"),detail:`${this.$t("mission_error")}`,life:3e3})})},getTimes(t){r.get(`api/employees/get/with/calendar/${this.event.employee_id}?type=${t}`).then(s=>{console.log(s.data.data.days);const l=Array.isArray(s.data.data.days)?s.data.data.days:[];this.avalible_day=l,this.business_hours=l.map(e=>({day:new Date(e.start).getDay(),start:p(e.start).format("HH:mm:ss"),end:p(e.end).format("HH:mm:ss")}));const n=this.business_hours.map(e=>e.day);this.opts.hiddenDays=this.days.filter(e=>!n.includes(e)),this.opts.events=s.data.data.booked.map(e=>({title:e.title,start:`${e.date}T${e.start_time}+02:00`,end:`${e.date}T${e.end_time}+02:00`,backgroundColor:"#"+e.color}))}).catch(s=>{console.error("Error fetching times:",s)})},handleEventClick(t){this.event_id=t.event.id,this.event.title=t.event.title,this.event.color="#"+t.event.color,this.event.start_time=p(t.event.start).format("HH:mm:ss"),this.event.end_time=p(t.event.end).format("HH:mm:ss"),this.updateevent=!0},handleSelect(t){this.opts.event=t;const s=new Date(t.startStr);this.opts.slotMinTime=this.business_hours.find(l=>l.day===s.getDay()).start,this.opts.slotMaxTime=this.business_hours.find(l=>l.day===s.getDay()).end,t.view.type=="dayGridMonth"&&this.avalible_day.some(l=>l.start.includes(t.startStr))?this.$refs.fullCalendar.getApi().changeView("timeGridDay",t.startStr):t.view.type=="timeGridDay"?this.visible=!0:this.not_find=!0},createEvent(){r.post("/api/event-calendar",this.event).then(()=>{this.updateEvents(),this.visible=!1,this.$toast.add({severity:"success",summary:this.$t("success_message"),detail:`${this.$t("element_add_success")}`,life:3e3})}).catch(t=>{this.$toast.add({severity:"error",summary:this.$t("error"),detail:`${t.response.data.message}`,life:3e3})})},updateEvent(){r.put(`/api/event-calendar/${this.event_id}`,this.event).then(()=>{this.updateevent=!1,this.updateEvents()})},deleteEvent(){r.delete("api/evaluations/44/delete").then(t=>{})},resetModal(){this.visible=!1,this.updateevent=!1,this.event={color:"87ceeb"}}},watch:{business_hours(t,s){if(t.length>=1){const l=t.map(n=>n.day);this.opts.hiddenDays=this.days.filter(n=>!l.includes(n))}else this.opts.hiddenDays=[]}},mounted(){this.getClidreen(),this.fetchEmployees(),this.doctorshow=localStorage.getItem("type"),this.opts.locale=localStorage.appLang==="en"?null:G,console.log(this.$route.params.id),this.event.child_id=parseInt(this.$route.params.id)}},Y={class:"flex"},q={class:"flex flex-column"},N={class:"text-right"},W={class:"flex flex-column gap-2 py-1"},j={class:"w-full text-right",for:"username"},z={class:"flex flex-column gap-2 py-1"},R={class:"w-full text-right",for:"username"},J={class:"w-full text-center"},K={class:"font-bold text-xl text-center py-1"},O={class:"font-bold text-lg text-center py-1"};function P(t,s,l,n,e,h){const c=m("Dropdown"),b=m("Toolbar"),g=m("FullCalendar"),x=m("InputText"),y=m("Button"),v=m("Dialog"),D=m("Toast");return f(),T(A,null,[o(M,{class:"p-[1%] bg-slate-50"},{default:u(()=>[o(b,{class:"mb-4 shadow-md"},{start:u(()=>[a("div",Y,[o(c,{"onUpdate:modelValue":[s[0]||(s[0]=i=>e.event.type=""),s[1]||(s[1]=i=>e.event.employee_id=i)],placeholder:t.$t("employee_name"),id:"pv_id_1",style:{direction:"ltr !important","text-align":"center !important"},modelValue:e.event.employee_id,"option-value":"user_id",filter:"",options:e.employees,optionLabel:"name",class:"mx-2"},null,8,["placeholder","modelValue","options"]),o(c,{loading:!e.event.employee_id,"onUpdate:modelValue":[h.getTimes,s[2]||(s[2]=i=>e.event.type=i)],placeholder:t.$t("type_work"),id:"pv_id_1",style:{direction:"ltr !important","text-align":"center !important"},modelValue:e.event.type,"option-value":"id",filter:"",options:e.event_types,optionLabel:"name"},null,8,["loading","onUpdate:modelValue","placeholder","modelValue","options"])])]),end:u(()=>[]),_:1}),e.business_hours.length>=1?(f(),S(g,{key:0,options:e.opts,ref:"fullCalendar"},null,8,["options"])):E("",!0),o(v,{visible:e.visible,"onUpdate:visible":s[8]||(s[8]=i=>e.visible=i),id:"modal",modal:"",header:t.$t("submit"),style:{width:"40vw"}},{default:u(()=>[a("form",{onSubmit:s[7]||(s[7]=H((...i)=>h.create&&h.create(...i),["prevent"])),class:""},[a("div",q,[a("label",N,d(t.$t("title")),1),o(x,{modelValue:e.event.title,"onUpdate:modelValue":s[3]||(s[3]=i=>e.event.title=i),class:_({"p-invalid":e.submitted&&!e.event.title})},null,8,["modelValue","class"])]),a("div",W,[a("label",j,d(t.$t("evalute_type")),1),o(c,{required:"",id:"pv_id_1",style:{direction:"ltr !important","text-align":"center !important"},modelValue:e.event.evaluation_type,"onUpdate:modelValue":s[4]||(s[4]=i=>e.event.evaluation_type=i),"option-value":"id",options:e.evaluate_types,optionLabel:"name",class:_(["w-full",{"p-invalid":e.submitted&&!e.event.evaluation_type}])},null,8,["modelValue","options","class"])]),a("div",z,[a("label",R,d(t.$t("child_name")),1),o(c,{disabled:"",required:"",id:"pv_id_1",style:{direction:"ltr !important","text-align":"center !important"},modelValue:e.event.child_id,"onUpdate:modelValue":s[5]||(s[5]=i=>e.event.child_id=i),"option-value":"id",filter:"",options:e.childreen,optionLabel:"name",class:_(["w-full",{"p-invalid":e.submitted&&!e.event.child_id}])},null,8,["modelValue","options","class"])]),a("div",J,[o(y,{type:"submit",onClick:s[6]||(s[6]=i=>e.submitted=!0),class:"create m-auto w-[50%] my-4",label:t.$t("submit")},null,8,["label"])])],32)]),_:1},8,["visible","header"]),o(v,{visible:e.updateevent,"onUpdate:visible":s[9]||(s[9]=i=>e.updateevent=i),id:"modal",modal:"",header:e.modal_text,style:{width:"40vw"}},{default:u(()=>[a("form",null,[a("h2",K,d(e.event.title),1),a("p",O,d(t.$t("from"))+" "+d(e.event.start_time)+" "+d(t.$t("to"))+" "+d(e.event.end_time),1),o(y,{class:"delete mt-3",icon:"pi pi-trash",onClick:h.deleteEvent},null,8,["onClick"])])]),_:1},8,["visible","header"]),o(v,{visible:e.not_find,"onUpdate:visible":s[10]||(s[10]=i=>e.not_find=i),id:"modal",modal:"",header:e.modal_text,style:{width:"40vw"}},{default:u(()=>[a("form",null,[a("p",null,d(t.$t("no_open_positions")),1)])]),_:1},8,["visible","header"])]),_:1}),o(D)],64)}const te=w(I,[["render",P],["__scopeId","data-v-a15780d2"]]);export{te as default};
